import{G as T,r as c,u as C,a as N,s as p,H as n}from"./index-CU2fudyf.js";import{u as b}from"./mainStore-BhzJHaPt.js";const j=T("transaction",()=>{const r=c(!1),u=c([]),i=c([]),l=c([]),v=c(null),m=c(!1),f=C(),y=c(""),h=b(),d=N(),{contest:_}=p(h),{user:g}=p(d);async function w(s,o){var t,e;try{if(r.value=!0,!s||isNaN(s)||s<=0)throw new Error("Invalid amount. Please enter a valid positive number.");const a=await n.post("/funds/transaction",{action:"deposit",amount:s,transaction_id:o});return r.value=!1,{success:a.data.success,message:a.data.message}}catch(a){return r.value=!1,console.error("Error Adding Fund:",a),{success:!1,message:((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||"An unexpected error occurred"}}}async function M(s){var o,t;try{r.value=!0;const e=await n.post("/razorpay/order/create",{amount:s});console.log("response data:",e.data.data);const a={key:e.data.data.key,amount:e.data.data.amount,currency:e.data.data.currency,name:"Himpri",description:"Order Payment",order_id:e.data.data.order_id,handler:function(P){A(P)},prefill:{name:g.value.name,email:g.value.email,contact:g.value.mobile},theme:{color:"#3399cc"}};return new Razorpay(a).open(),r.value=!1,{success:e.data.success,message:e.data.message,order_id:e.data.data.order_id}}catch(e){return r.value=!1,console.error("Error Adding Fund:",e),{success:!1,message:((t=(o=e.response)==null?void 0:o.data)==null?void 0:t.message)||"An unexpected error occurred"}}}async function A(s){var o,t;try{r.value=!0;const e=await n.post("razorpay/payment/verify",{razorpay_payment_id:s.razorpay_payment_id,razorpay_order_id:s.razorpay_order_id,razorpay_signature:s.razorpay_signature});return e.data.success?(m.value=!0,d.fetchUser(),f.success(e.data.message)):f.error(e.data.message),r.value=!1,{success:e.data.success,message:e.data.message}}catch(e){return r.value=!1,console.error("Error Adding Fund:",e),{success:!1,message:((t=(o=e.response)==null?void 0:o.data)==null?void 0:t.message)||"An unexpected error occurred"}}}async function z(s){var o,t;try{if(r.value=!0,!s||isNaN(s)||s<=0)throw new Error("Invalid amount. Please enter a valid positive number.");const e=await n.post("/funds/transaction",{action:"withdraw",amount:s});return r.value=!1,{success:e.data.success,message:e.data.message}}catch(e){return r.value=!1,console.error("Error Withdrawing Fund:",e),{success:!1,message:((t=(o=e.response)==null?void 0:o.data)==null?void 0:t.message)||"An unexpected error occurred"}}}async function E(s){var o,t;try{r.value=!0;const e=await n.post("/play/quiz/join",{node_id:_.value.node_id,variant_id:s});return d.fetchUser(),r.value=!1,{success:e.data.success,message:e.data.message}}catch(e){return r.value=!1,console.error("Error Joining Game:",e),{success:!1,message:((t=(o=e.response)==null?void 0:o.data)==null?void 0:t.message)||"An unexpected error occurred"}}}async function x(s=1){var o,t;try{r.value=!0;const e={page:s},a=await n.get("/funds/transaction/list",{params:e});return s===1?u.value=a.data.data.transactions:u.value=[...u.value,...a.data.data.transactions],r.value=!1,{success:a.data.success,message:a.data.message,pagination:a.data.data.totalCount>u.value.length}}catch(e){return r.value=!1,console.error("Error getting transactions:",e),{success:!1,message:((t=(o=e.response)==null?void 0:o.data)==null?void 0:t.message)||"An unexpected error occurred"}}}async function S(s=1){var o,t;try{const e={page:s};r.value=!0;const a=await n.get("/lifeline/transaction/list",{params:e});return s===1?i.value=a.data.data.lifeline_transactions:i.value=[...i.value,...a.data.data.lifeline_transactions],r.value=!1,{success:a.data.success,message:a.data.message,pagination:a.data.data.totalCount>i.value.length}}catch(e){return r.value=!1,console.error("Error Joining Game:",e),{success:!1,message:((t=(o=e.response)==null?void 0:o.data)==null?void 0:t.message)||"An unexpected error occurred"}}}async function F(s=1){var o,t;try{r.value=!0;const e={page:s},a=await n.get("/lifeline/history/list",{params:e});return a.data.data.totalCount>0&&(s===1?l.value=a.data.data.lifeline_histories:l.value=[...l.value,...a.data.data.lifeline_histories]),r.value=!1,{success:a.data.success,message:a.data.message,pagination:a.data.data.totalCount>l.value.length}}catch(e){return r.value=!1,console.error("Error Joining Game:",e),{success:!1,message:((t=(o=e.response)==null?void 0:o.data)==null?void 0:t.message)||"An unexpected error occurred"}}}return{getTransactions:x,getLifelineTransactions:S,getLifelineHistories:F,payWithRazorpay:M,withdrawFunds:z,addFunds:w,joinGame:E,fundAction:y,loading:r,error:v,transactions:u,lifeline_transactions:i,showPaymentSuccess:m,lifeline_histories:l}});export{j as u};
