import{G as P,r as c,u as G,a as N,s as p,H as n}from"./index-DPnwqptS.js";import{u as T}from"./mainStore-CkFnAuxP.js";const H=P("transaction",()=>{const r=c(!1),u=c([]),i=c([]),f=c(null),m=c(!1),g=G(),v=c(""),y=T(),d=N(),{contest:h}=p(y),{user:l}=p(d);async function _(s,o){var t,e;try{if(r.value=!0,!s||isNaN(s)||s<=0)throw new Error("Invalid amount. Please enter a valid positive number.");const a=await n.post("/funds/transaction",{action:"deposit",amount:s,transaction_id:o});return r.value=!1,{success:a.data.success,message:a.data.message}}catch(a){return r.value=!1,console.error("Error Adding Fund:",a),{success:!1,message:((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||"An unexpected error occurred"}}}async function w(s){var o,t;try{r.value=!0;const e=await n.post("/razorpay/order/create",{amount:s});console.log("response data:",e.data.data);const a={key:e.data.data.key,amount:e.data.data.amount,currency:e.data.data.currency,name:"Himpri",description:"Order Payment",order_id:e.data.data.order_id,handler:function(F){M(F)},prefill:{name:l.value.name,email:l.value.email,contact:l.value.mobile},theme:{color:"#3399cc"}};return new Razorpay(a).open(),r.value=!1,{success:e.data.success,message:e.data.message,order_id:e.data.data.order_id}}catch(e){return r.value=!1,console.error("Error Adding Fund:",e),{success:!1,message:((t=(o=e.response)==null?void 0:o.data)==null?void 0:t.message)||"An unexpected error occurred"}}}async function M(s){var o,t;try{r.value=!0;const e=await n.post("razorpay/payment/verify",{razorpay_payment_id:s.razorpay_payment_id,razorpay_order_id:s.razorpay_order_id,razorpay_signature:s.razorpay_signature});return e.data.success?(m.value=!0,d.fetchUser(),g.success(e.data.message)):g.error(e.data.message),r.value=!1,{success:e.data.success,message:e.data.message}}catch(e){return r.value=!1,console.error("Error Adding Fund:",e),{success:!1,message:((t=(o=e.response)==null?void 0:o.data)==null?void 0:t.message)||"An unexpected error occurred"}}}async function z(s){var o,t;try{if(r.value=!0,!s||isNaN(s)||s<=0)throw new Error("Invalid amount. Please enter a valid positive number.");const e=await n.post("/funds/transaction",{action:"withdraw",amount:s});return r.value=!1,{success:e.data.success,message:e.data.message}}catch(e){return r.value=!1,console.error("Error Withdrawing Fund:",e),{success:!1,message:((t=(o=e.response)==null?void 0:o.data)==null?void 0:t.message)||"An unexpected error occurred"}}}async function A(s){var o,t;try{r.value=!0;const e=await n.post("/play/quiz/join",{node_id:h.value.node_id,variant_id:s});return d.fetchUser(),r.value=!1,{success:e.data.success,message:e.data.message}}catch(e){return r.value=!1,console.error("Error Joining Game:",e),{success:!1,message:((t=(o=e.response)==null?void 0:o.data)==null?void 0:t.message)||"An unexpected error occurred"}}}async function E(s=1){var o,t;try{r.value=!0;const e={page:s},a=await n.get("/funds/transaction/list",{params:e});return s===1?u.value=a.data.data.transactions:u.value=[...u.value,...a.data.data.transactions],r.value=!1,{success:a.data.success,message:a.data.message,pagination:a.data.data.totalCount>u.value.length}}catch(e){return r.value=!1,console.error("Error getting transactions:",e),{success:!1,message:((t=(o=e.response)==null?void 0:o.data)==null?void 0:t.message)||"An unexpected error occurred"}}}async function x(s=1){var o,t;try{r.value=!0;const e={page:s},a=await n.get("/lifeline/history/list",{params:e});return a.data.data.totalCount>0&&(s===1?i.value=a.data.data.lifeline_histories:i.value=[...i.value,...a.data.data.lifeline_histories]),r.value=!1,{success:a.data.success,message:a.data.message,pagination:a.data.data.totalCount>i.value.length}}catch(e){return r.value=!1,console.error("Error Joining Game:",e),{success:!1,message:((t=(o=e.response)==null?void 0:o.data)==null?void 0:t.message)||"An unexpected error occurred"}}}return{getTransactions:E,getLifelineHistories:x,payWithRazorpay:w,withdrawFunds:z,addFunds:_,joinGame:A,fundAction:v,loading:r,error:f,transactions:u,showPaymentSuccess:m,lifeline_histories:i}});export{H as u};
