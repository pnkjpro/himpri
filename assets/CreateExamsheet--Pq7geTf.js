import{_ as X,u as Z,r as _,s as ee,x as te,c as a,b as e,t as u,w as T,f as d,z as E,F as q,d as V,i as z,v as c,p as k,o as l,n as se}from"./index-CHPCHxS5.js";import{u as ie}from"./adminStore-2csNTwoO.js";import{u as ne}from"./mainStore-BTugurHL.js";const oe={class:"quiz-form-container"},re={class:"form-title"},ae={class:"form-group"},le=["value"],ue={class:"form-group"},de={class:"form-group"},pe={class:"form-group"},me={key:0,class:"image-preview"},ce=["src"],ve={class:"form-group date-time-group"},fe={class:"date-time-input"},ye={class:"date-time-input"},_e={class:"form-group"},be={class:"form-group"},ze={class:"input-with-prefix"},ge={class:"form-group"},qe={class:"input-with-prefix"},Ve={class:"form-group"},ke={class:"form-group"},we={key:1,class:"quiz-form"},Se={class:"variant-section"},Ce={class:"section-title"},he={class:"form-group"},Oe={class:"input-with-prefix"},Qe={class:"form-group"},Ee={class:"input-with-prefix"},Ae={class:"form-group"},$e={class:"form-group"},Ne={class:"form-group"},xe={class:"prize-ranks-container"},Te={class:"rank-label"},Ue={class:"input-with-prefix"},Je=["onUpdate:modelValue"],Ie=["onClick"],De={class:"form-actions"},Pe=["disabled"],Re={key:0,class:"variants-summary"},Fe={class:"summary-title"},Me={class:"variant-summary-number"},Be={class:"variant-summary-text"},Le={class:"variant-detail"},je={class:"variant-detail"},Ke={class:"variant-detail"},We={class:"variant-actions"},Ye=["onClick"],Ge=["onClick"],He={class:"question-section"},Xe={class:"section-title"},Ze={class:"form-group"},et={class:"form-group"},tt={class:"options-grid"},st=["for"],it=["id","onUpdate:modelValue","placeholder"],nt={class:"form-group"},ot=["value","disabled"],rt={class:"form-actions"},at=["disabled"],lt={key:0,class:"questions-summary"},ut={class:"summary-title"},dt={class:"question-summary-number"},pt={class:"question-summary-text"},mt={class:"question-actions"},ct=["onClick"],vt={__name:"CreateExamsheet",setup(ft){const p=Z();let w=_(1),b=_([]);const y=_(1),C=_(null),v=_([]),h=_(-1),S=_(!1),O=ie(),A=ne(),{categories:U}=ee(A);te(()=>{A.fetchCategories()});const $={category_id:null,title:"",description:"",banner_image:null,start_time:"",end_time:"",quizContents:{},spot_limit:100,entry_fees:0,prize_money:0,quiz_timer:0,winners:0},N={entry_fee:0,prize:0,slot_limit:100,status:"active",prize_contents:{1:0}},Q={id:1,question:"",options:[{id:1,option:""},{id:2,option:""},{id:3,option:""},{id:4,option:""}],correctAnswerId:""},o=_(JSON.parse(JSON.stringify($))),r=_(JSON.parse(JSON.stringify(N))),f=_(JSON.parse(JSON.stringify(Q))),J=n=>{const t=n.target.files[0];if(t){o.value.banner_image=t;const s=new FileReader;s.onload=i=>{C.value=i.target.result},s.readAsDataURL(t)}},I=()=>{if(new Date(o.value.end_time)<=new Date(o.value.start_time)){p.error("End time must be after start time");return}y.value=2,x()},D=()=>{if(v.value.length===0){p.error("You need to add at least one variant");return}y.value=3},P=()=>{y.value=1},R=()=>{y.value=2},x=()=>{r.value=JSON.parse(JSON.stringify(N)),S.value=!1,h.value=-1},F=()=>{const n=Object.keys(r.value.prize_contents),t=n.length>0?parseInt(n[n.length-1])+1:1;r.value.prize_contents[t]=0},M=n=>{const t={};Object.keys(r.value.prize_contents).filter(s=>s!==n).forEach(s=>{t[s]=r.value.prize_contents[s]}),r.value.prize_contents=t},B=()=>{if(r.value.entry_fee<0){p.error("Entry fee cannot be negative");return}if(r.value.prize<0){p.error("Prize amount cannot be negative");return}if(Object.keys(r.value.prize_contents).length!=o.value.winners){p.error("Variant winners should be same as winners");return}if(Object.values(r.value.prize_contents).reduce((t,s)=>t+s,0)>r.value.prize){p.error("Total prize distribution exceeds the total prize amount");return}S.value?v.value[h.value]=JSON.parse(JSON.stringify(r.value)):v.value.push(JSON.parse(JSON.stringify(r.value))),x(),p.success(S.value?"Variant updated successfully":"Variant added successfully")},L=n=>{r.value=JSON.parse(JSON.stringify(v.value[n])),h.value=n,S.value=!0},j=n=>{confirm("Are you sure you want to delete this variant?")&&(v.value.splice(n,1),p.success("Variant deleted successfully"))},K=()=>{if(!f.value.correctAnswerId){p.error("Please select a correct answer");return}b.value.push({...f.value,id:w.value}),w.value++,f.value=JSON.parse(JSON.stringify(Q)),f.value.id=w.value,p.success("Question added successfully")},W=n=>{confirm("Are you sure you want to delete this question?")&&(b.value.splice(n,1),p.success("Question deleted successfully"))},Y=()=>{o.value=JSON.parse(JSON.stringify($)),v.value=[],b.value=[],f.value=JSON.parse(JSON.stringify(Q)),y.value=1,w.value=1,C.value=null},G=async()=>{if(b.value.length===0){p.error("No questions added yet");return}const n=new FormData;n.append("category_id",o.value.category_id),n.append("title",o.value.title),n.append("description",o.value.description),n.append("start_time",o.value.start_time),n.append("end_time",o.value.end_time),n.append("spot_limit",o.value.spot_limit),n.append("entry_fees",o.value.entry_fees),n.append("prize_money",o.value.prize_money),n.append("quiz_timer",o.value.quiz_timer),n.append("winners",o.value.winners),o.value.banner_image&&n.append("banner_image",o.value.banner_image),v.value.forEach((s,i)=>{n.append(`quizVariants[${i}][entry_fee]`,s.entry_fee),n.append(`quizVariants[${i}][prize]`,s.prize),n.append(`quizVariants[${i}][slot_limit]`,s.slot_limit),n.append(`quizVariants[${i}][status]`,s.status),Object.entries(s.prize_contents).forEach(([m,g])=>{n.append(`quizVariants[${i}][prize_contents][${m}]`,g)})}),b.value.forEach((s,i)=>{n.append(`quizContents[${i}][id]`,s.id),n.append(`quizContents[${i}][question]`,s.question),s.options.forEach((m,g)=>{n.append(`quizContents[${i}][options][${g}][id]`,m.id),n.append(`quizContents[${i}][options][${g}][option]`,m.option)}),n.append(`quizContents[${i}][correctAnswerId]`,s.correctAnswerId)});const t=await O.createQuiz(n);if(t.success)p.success(t.message),Y();else{const s=t.message;typeof s=="object"&&s!==null&&!Array.isArray(s)?Object.values(s).forEach((i,m)=>{i.forEach((g,H)=>{setTimeout(()=>p.error(g),(m+H)*300)})}):Array.isArray(s)?s.forEach((i,m)=>{setTimeout(()=>p.error(i),m*300)}):p.error(s);return}};return(n,t)=>(l(),a("div",oe,[e("h2",re,u(y.value===1?"Create Quiz":y.value===2?"Create Quiz Variants":"Create Quiz Questions"),1),y.value===1?(l(),a("form",{key:0,class:"quiz-form",onSubmit:T(I,["prevent"])},[e("div",ae,[t[16]||(t[16]=e("label",{for:"category"},"Select Category",-1)),d(e("select",{id:"category","onUpdate:modelValue":t[0]||(t[0]=s=>o.value.category_id=s),class:"form-control",required:""},[(l(!0),a(q,null,V(z(U),s=>(l(),a("option",{key:s.id,value:s.id},u(s.name),9,le))),128))],512),[[E,o.value.category_id]])]),e("div",ue,[t[17]||(t[17]=e("label",{for:"title"},"Title",-1)),d(e("input",{type:"text",id:"title","onUpdate:modelValue":t[1]||(t[1]=s=>o.value.title=s),placeholder:"Enter Quiz Title",class:"form-control",required:""},null,512),[[c,o.value.title]])]),e("div",de,[t[18]||(t[18]=e("label",{for:"description"},"Description",-1)),d(e("textarea",{id:"description","onUpdate:modelValue":t[2]||(t[2]=s=>o.value.description=s),placeholder:"Enter Quiz Description",class:"form-control",rows:"4",required:""},null,512),[[c,o.value.description]])]),e("div",pe,[t[19]||(t[19]=e("label",{for:"bannerImage"},"Banner Image",-1)),e("input",{type:"file",id:"bannerImage",onChange:J,class:"form-control file-input",accept:"image/*"},null,32),C.value?(l(),a("div",me,[e("img",{src:C.value,alt:"Banner preview"},null,8,ce)])):k("",!0),t[20]||(t[20]=e("span",{class:"text-xs text-blue-500"},"Note: Banner size 256x144 and should not exceed 200 Kb for better frontload.",-1))]),e("div",ve,[e("div",fe,[t[21]||(t[21]=e("label",{for:"startTime"},"Start Time",-1)),d(e("input",{type:"datetime-local",id:"startTime","onUpdate:modelValue":t[3]||(t[3]=s=>o.value.start_time=s),class:"form-control",required:""},null,512),[[c,o.value.start_time]])]),e("div",ye,[t[22]||(t[22]=e("label",{for:"endTime"},"End Time",-1)),d(e("input",{type:"datetime-local",id:"endTime","onUpdate:modelValue":t[4]||(t[4]=s=>o.value.end_time=s),class:"form-control",required:""},null,512),[[c,o.value.end_time]])])]),e("div",_e,[t[23]||(t[23]=e("label",{for:"spotLimit"},"Spot Limit",-1)),d(e("input",{type:"number",id:"spotLimit","onUpdate:modelValue":t[5]||(t[5]=s=>o.value.spot_limit=s),placeholder:"Enter Spot Limit",class:"form-control",min:"1",required:""},null,512),[[c,o.value.spot_limit,void 0,{number:!0}]])]),e("div",be,[t[25]||(t[25]=e("label",{for:"entryFees"},"Entry Fees",-1)),e("div",ze,[t[24]||(t[24]=e("span",{class:"input-prefix"},"Rs",-1)),d(e("input",{type:"number",id:"entryFees","onUpdate:modelValue":t[6]||(t[6]=s=>o.value.entry_fees=s),placeholder:"Input Entry Fees",class:"form-control",min:"0",required:""},null,512),[[c,o.value.entry_fees,void 0,{number:!0}]])])]),e("div",ge,[t[27]||(t[27]=e("label",{for:"prizeMoney"},"Prize Money",-1)),e("div",qe,[t[26]||(t[26]=e("span",{class:"input-prefix"},"Rs",-1)),d(e("input",{type:"number",id:"prizeMoney","onUpdate:modelValue":t[7]||(t[7]=s=>o.value.prize_money=s),placeholder:"Input Prize Money",class:"form-control",min:"0",required:""},null,512),[[c,o.value.prize_money,void 0,{number:!0}]])])]),e("div",Ve,[t[28]||(t[28]=e("label",{for:"quiztimer"},"Quiz Timer",-1)),d(e("input",{type:"number",id:"quizTimer","onUpdate:modelValue":t[8]||(t[8]=s=>o.value.quiz_timer=s),placeholder:"Quiz Timer in Seconds",class:"form-control",min:"0",required:""},null,512),[[c,o.value.quiz_timer,void 0,{number:!0}]]),t[29]||(t[29]=e("span",{style:{"font-size":"14px",color:"darkgrey"}},"Quiz Timer in Seconds",-1))]),e("div",ke,[t[30]||(t[30]=e("label",{for:"winners"},"Total Winners",-1)),d(e("input",{type:"number",id:"quizTimer","onUpdate:modelValue":t[9]||(t[9]=s=>o.value.winners=s),placeholder:"Enter total winners",class:"form-control",min:"0",required:""},null,512),[[c,o.value.winners,void 0,{number:!0}]]),t[31]||(t[31]=e("span",{style:{"font-size":"14px",color:"darkgrey"}},"All variants should contain same number of winners",-1))]),t[32]||(t[32]=e("div",{class:"form-actions"},[e("button",{type:"submit",class:"btn-save"}," Proceed to Variants ")],-1))],32)):k("",!0),y.value===2?(l(),a("div",we,[e("div",Se,[e("h3",Ce,"Quiz Variant "+u(h.value+1),1),e("div",he,[t[34]||(t[34]=e("label",{for:"entryFees"},"Entry Fees",-1)),e("div",Oe,[t[33]||(t[33]=e("span",{class:"input-prefix"},"Rs",-1)),d(e("input",{type:"number",id:"entryFees","onUpdate:modelValue":t[10]||(t[10]=s=>r.value.entry_fee=s),placeholder:"Input Entry Fees",class:"form-control",min:"0",required:""},null,512),[[c,r.value.entry_fee,void 0,{number:!0}]])])]),e("div",Qe,[t[36]||(t[36]=e("label",{for:"prizeMoney"},"Prize Money",-1)),e("div",Ee,[t[35]||(t[35]=e("span",{class:"input-prefix"},"Rs",-1)),d(e("input",{type:"number",id:"prizeMoney","onUpdate:modelValue":t[11]||(t[11]=s=>r.value.prize=s),placeholder:"Input Prize Money",class:"form-control",min:"0",required:""},null,512),[[c,r.value.prize,void 0,{number:!0}]])])]),e("div",Ae,[t[37]||(t[37]=e("label",{for:"spotLimit"},"Slot Limit",-1)),d(e("input",{type:"number",id:"spotLimit","onUpdate:modelValue":t[12]||(t[12]=s=>r.value.slot_limit=s),placeholder:"Enter Slot Limit",class:"form-control",min:"1",required:""},null,512),[[c,r.value.slot_limit,void 0,{number:!0}]])]),e("div",$e,[t[39]||(t[39]=e("label",{for:"status"},"Status",-1)),d(e("select",{id:"status","onUpdate:modelValue":t[13]||(t[13]=s=>r.value.status=s),class:"form-control",required:""},t[38]||(t[38]=[e("option",{value:"active"},"Active",-1),e("option",{value:"inactive"},"Inactive",-1),e("option",{value:"draft"},"Draft",-1)]),512),[[E,r.value.status]])]),e("div",Ne,[e("div",{class:"prize-distribution-header"},[t[40]||(t[40]=e("label",null,"Prize Distribution",-1)),e("button",{type:"button",onClick:F,class:"btn-add-rank"},"+ Add Rank")]),e("div",xe,[(l(!0),a(q,null,V(r.value.prize_contents,(s,i)=>(l(),a("div",{key:i,class:"prize-rank-item"},[e("div",Te,"Rank "+u(i),1),e("div",Ue,[t[41]||(t[41]=e("span",{class:"input-prefix"},"Rs",-1)),d(e("input",{type:"number","onUpdate:modelValue":m=>r.value.prize_contents[i]=m,placeholder:"Prize amount",class:"form-control",min:"0",required:""},null,8,Je),[[c,r.value.prize_contents[i],void 0,{number:!0}]])]),e("button",{type:"button",onClick:m=>M(i),class:"btn-remove-rank",title:"Remove this rank"}," × ",8,Ie)]))),128))])])]),e("div",De,[e("button",{type:"button",onClick:P,class:"btn-cancel"}," Back to Quiz Info "),e("button",{type:"button",onClick:B,class:"btn-save"},u(S.value?"Update Variant":"Add Variant"),1),e("button",{type:"button",onClick:D,class:"btn-primary",disabled:v.value.length===0}," Proceed to Questions ",8,Pe)]),v.value.length>0?(l(),a("div",Re,[e("h3",Fe,"Variants Added ("+u(v.value.length)+")",1),(l(!0),a(q,null,V(v.value,(s,i)=>(l(),a("div",{key:`variant-${i}`,class:"variant-summary-item"},[e("div",Me,u(i+1),1),e("div",Be,[e("span",Le,"Entry: Rs "+u(s.entry_fee),1),e("span",je,"Prize: Rs "+u(s.prize),1),e("span",Ke,"Slots: "+u(s.slot_limit),1),e("span",{class:se(["variant-status",s.status])},u(s.status),3)]),e("div",We,[e("button",{onClick:m=>L(i),class:"btn-edit-variant",title:"Edit variant"}," Edit ",8,Ye),e("button",{onClick:m=>j(i),class:"btn-delete-variant",title:"Delete variant"}," Delete ",8,Ge)])]))),128))])):k("",!0)])):k("",!0),y.value===3?(l(),a("form",{key:2,class:"quiz-form",onSubmit:T(K,["prevent"])},[e("div",He,[e("h3",Xe,"Question "+u(z(w)),1),e("div",Ze,[t[42]||(t[42]=e("label",{for:"question"},"Question",-1)),d(e("input",{type:"text",id:"question","onUpdate:modelValue":t[14]||(t[14]=s=>f.value.question=s),placeholder:"Enter your question",class:"form-control",required:""},null,512),[[c,f.value.question]])]),e("div",et,[t[43]||(t[43]=e("label",null,"Options",-1)),e("div",tt,[(l(!0),a(q,null,V(f.value.options,(s,i)=>(l(),a("div",{key:`option-${i}`,class:"option-item"},[e("label",{for:`option${i+1}`},"Option "+u(i+1),9,st),d(e("input",{id:`option${i+1}`,type:"text","onUpdate:modelValue":m=>s.option=m,placeholder:`Option ${i+1}`,class:"form-control",required:""},null,8,it),[[c,s.option]])]))),128))])]),e("div",nt,[t[45]||(t[45]=e("label",{for:"correctAnswer"},"Correct Answer",-1)),d(e("select",{id:"correctAnswer","onUpdate:modelValue":t[15]||(t[15]=s=>f.value.correctAnswerId=s),class:"form-control",required:""},[t[44]||(t[44]=e("option",{value:""},"Select correct answer",-1)),(l(!0),a(q,null,V(f.value.options,(s,i)=>(l(),a("option",{key:`answer-${i}`,value:s.id,disabled:!s.option},u(s.option||`Option ${i+1}`),9,ot))),128))],512),[[E,f.value.correctAnswerId]])])]),e("div",rt,[e("button",{type:"button",onClick:R,class:"btn-cancel"}," Back to Variants "),t[46]||(t[46]=e("button",{type:"submit",class:"btn-save"}," Add Question ",-1)),e("button",{type:"button",onClick:G,class:"btn-primary",disabled:z(b).length===0||z(O).loading},u(z(O).loading?"Creating Quiz...":"Finish & Create Quiz"),9,at)]),z(b).length>0?(l(),a("div",lt,[e("h3",ut,"Questions Added ("+u(z(b).length)+")",1),(l(!0),a(q,null,V(z(b),(s,i)=>(l(),a("div",{key:`summary-${i}`,class:"question-summary-item"},[e("div",dt,u(i+1),1),e("div",pt,u(s.question),1),e("div",mt,[e("button",{onClick:m=>W(i),class:"btn-delete-question",title:"Delete question"}," Delete ",8,ct)])]))),128))])):k("",!0)],32)):k("",!0)]))}},zt=X(vt,[["__scopeId","data-v-536c2c8a"]]);export{zt as default};
