import{_ as X,u as Z,r as _,s as ee,x as te,c as a,b as e,t as u,w as T,f as d,z as E,F as q,d as V,i as z,v as c,p as k,o as l,n as se}from"./index-Bjie691a.js";import{u as ie}from"./adminStore-BjpcbFxs.js";import{u as oe}from"./mainStore-Bf8H3LFE.js";const ne={class:"quiz-form-container"},re={class:"form-title"},ae={class:"form-group"},le=["value"],ue={class:"form-group"},de={class:"form-group"},pe={class:"form-group"},me={key:0,class:"image-preview"},ce=["src"],ve={class:"form-group date-time-group"},fe={class:"date-time-input"},ye={class:"date-time-input"},_e={class:"form-group"},be={class:"form-group"},ze={class:"input-with-prefix"},ge={class:"form-group"},qe={class:"input-with-prefix"},Ve={class:"form-group"},ke={key:1,class:"quiz-form"},Se={class:"variant-section"},Ce={class:"section-title"},he={class:"form-group"},we={class:"input-with-prefix"},Oe={class:"form-group"},Qe={class:"input-with-prefix"},Ee={class:"form-group"},$e={class:"form-group"},Ae={class:"form-group"},Ne={class:"prize-ranks-container"},Ue={class:"rank-label"},Te={class:"input-with-prefix"},Je=["onUpdate:modelValue"],Ie=["onClick"],xe={class:"form-actions"},De=["disabled"],Pe={key:0,class:"variants-summary"},Re={class:"summary-title"},Fe={class:"variant-summary-number"},Me={class:"variant-summary-text"},Le={class:"variant-detail"},Be={class:"variant-detail"},je={class:"variant-detail"},Ye={class:"variant-actions"},Ge=["onClick"],He=["onClick"],Ke={class:"question-section"},We={class:"section-title"},Xe={class:"form-group"},Ze={class:"form-group"},et={class:"options-grid"},tt=["for"],st=["id","onUpdate:modelValue","placeholder"],it={class:"form-group"},ot=["value","disabled"],nt={class:"form-actions"},rt=["disabled"],at={key:0,class:"questions-summary"},lt={class:"summary-title"},ut={class:"question-summary-number"},dt={class:"question-summary-text"},pt={class:"question-actions"},mt=["onClick"],ct={__name:"CreateExamsheet",setup(vt){const m=Z();let S=_(1),b=_([]);const y=_(1),h=_(null),v=_([]),w=_(-1),C=_(!1),O=ie(),$=oe(),{categories:J}=ee($);te(()=>{$.fetchCategories()});const A={category_id:null,title:"",description:"",banner_image:null,start_time:"",end_time:"",quizContents:{},spot_limit:100,entry_fees:0,prize_money:0,quiz_timer:0},N={entry_fee:0,prize:0,slot_limit:100,status:"active",prize_contents:{1:0}},Q={id:1,question:"",options:[{id:1,option:""},{id:2,option:""},{id:3,option:""},{id:4,option:""}],correctAnswerId:""},n=_(JSON.parse(JSON.stringify(A))),r=_(JSON.parse(JSON.stringify(N))),f=_(JSON.parse(JSON.stringify(Q))),I=o=>{const t=o.target.files[0];if(t){n.value.banner_image=t;const s=new FileReader;s.onload=i=>{h.value=i.target.result},s.readAsDataURL(t)}},x=()=>{if(new Date(n.value.end_time)<=new Date(n.value.start_time)){m.error("End time must be after start time");return}y.value=2,U()},D=()=>{if(v.value.length===0){m.error("You need to add at least one variant");return}y.value=3},P=()=>{y.value=1},R=()=>{y.value=2},U=()=>{r.value=JSON.parse(JSON.stringify(N)),C.value=!1,w.value=-1},F=()=>{const o=Object.keys(r.value.prize_contents),t=o.length>0?parseInt(o[o.length-1])+1:1;r.value.prize_contents[t]=0},M=o=>{const t={};Object.keys(r.value.prize_contents).filter(s=>s!==o).forEach(s=>{t[s]=r.value.prize_contents[s]}),r.value.prize_contents=t},L=()=>{if(r.value.entry_fee<0){m.error("Entry fee cannot be negative");return}if(r.value.prize<0){m.error("Prize amount cannot be negative");return}if(Object.values(r.value.prize_contents).reduce((t,s)=>t+s,0)>r.value.prize){m.error("Total prize distribution exceeds the total prize amount");return}C.value?v.value[w.value]=JSON.parse(JSON.stringify(r.value)):v.value.push(JSON.parse(JSON.stringify(r.value))),U(),m.success(C.value?"Variant updated successfully":"Variant added successfully")},B=o=>{r.value=JSON.parse(JSON.stringify(v.value[o])),w.value=o,C.value=!0},j=o=>{confirm("Are you sure you want to delete this variant?")&&(v.value.splice(o,1),m.success("Variant deleted successfully"))},Y=()=>{if(!f.value.correctAnswerId){m.error("Please select a correct answer");return}b.value.push({...f.value,id:S.value}),S.value++,f.value=JSON.parse(JSON.stringify(Q)),f.value.id=S.value,m.success("Question added successfully")},G=o=>{confirm("Are you sure you want to delete this question?")&&(b.value.splice(o,1),m.success("Question deleted successfully"))},H=()=>{n.value=JSON.parse(JSON.stringify(A)),v.value=[],b.value=[],f.value=JSON.parse(JSON.stringify(Q)),y.value=1,S.value=1,h.value=null},K=async()=>{if(b.value.length===0){m.error("No questions added yet");return}const o=new FormData;o.append("category_id",n.value.category_id),o.append("title",n.value.title),o.append("description",n.value.description),o.append("start_time",n.value.start_time),o.append("end_time",n.value.end_time),o.append("spot_limit",n.value.spot_limit),o.append("entry_fees",n.value.entry_fees),o.append("prize_money",n.value.prize_money),o.append("quiz_timer",n.value.quiz_timer),n.value.banner_image&&o.append("banner_image",n.value.banner_image),v.value.forEach((s,i)=>{o.append(`quizVariants[${i}][entry_fee]`,s.entry_fee),o.append(`quizVariants[${i}][prize]`,s.prize),o.append(`quizVariants[${i}][slot_limit]`,s.slot_limit),o.append(`quizVariants[${i}][status]`,s.status),Object.entries(s.prize_contents).forEach(([p,g])=>{o.append(`quizVariants[${i}][prize_contents][${p}]`,g)})}),b.value.forEach((s,i)=>{o.append(`quizContents[${i}][id]`,s.id),o.append(`quizContents[${i}][question]`,s.question),s.options.forEach((p,g)=>{o.append(`quizContents[${i}][options][${g}][id]`,p.id),o.append(`quizContents[${i}][options][${g}][option]`,p.option)}),o.append(`quizContents[${i}][correctAnswerId]`,s.correctAnswerId)});const t=await O.createQuiz(o);if(t.success)m.success(t.message),H();else{const s=t.message;typeof s=="object"&&s!==null&&!Array.isArray(s)?Object.values(s).forEach((i,p)=>{i.forEach((g,W)=>{setTimeout(()=>m.error(g),(p+W)*300)})}):Array.isArray(s)?s.forEach((i,p)=>{setTimeout(()=>m.error(i),p*300)}):m.error(s);return}};return(o,t)=>(l(),a("div",ne,[e("h2",re,u(y.value===1?"Create Quiz":y.value===2?"Create Quiz Variants":"Create Quiz Questions"),1),y.value===1?(l(),a("form",{key:0,class:"quiz-form",onSubmit:T(x,["prevent"])},[e("div",ae,[t[15]||(t[15]=e("label",{for:"category"},"Select Category",-1)),d(e("select",{id:"category","onUpdate:modelValue":t[0]||(t[0]=s=>n.value.category_id=s),class:"form-control",required:""},[(l(!0),a(q,null,V(z(J),s=>(l(),a("option",{key:s.id,value:s.id},u(s.name),9,le))),128))],512),[[E,n.value.category_id]])]),e("div",ue,[t[16]||(t[16]=e("label",{for:"title"},"Title",-1)),d(e("input",{type:"text",id:"title","onUpdate:modelValue":t[1]||(t[1]=s=>n.value.title=s),placeholder:"Enter Quiz Title",class:"form-control",required:""},null,512),[[c,n.value.title]])]),e("div",de,[t[17]||(t[17]=e("label",{for:"description"},"Description",-1)),d(e("textarea",{id:"description","onUpdate:modelValue":t[2]||(t[2]=s=>n.value.description=s),placeholder:"Enter Quiz Description",class:"form-control",rows:"4",required:""},null,512),[[c,n.value.description]])]),e("div",pe,[t[18]||(t[18]=e("label",{for:"bannerImage"},"Banner Image",-1)),e("input",{type:"file",id:"bannerImage",onChange:I,class:"form-control file-input",accept:"image/*"},null,32),h.value?(l(),a("div",me,[e("img",{src:h.value,alt:"Banner preview"},null,8,ce)])):k("",!0)]),e("div",ve,[e("div",fe,[t[19]||(t[19]=e("label",{for:"startTime"},"Start Time",-1)),d(e("input",{type:"datetime-local",id:"startTime","onUpdate:modelValue":t[3]||(t[3]=s=>n.value.start_time=s),class:"form-control",required:""},null,512),[[c,n.value.start_time]])]),e("div",ye,[t[20]||(t[20]=e("label",{for:"endTime"},"End Time",-1)),d(e("input",{type:"datetime-local",id:"endTime","onUpdate:modelValue":t[4]||(t[4]=s=>n.value.end_time=s),class:"form-control",required:""},null,512),[[c,n.value.end_time]])])]),e("div",_e,[t[21]||(t[21]=e("label",{for:"spotLimit"},"Spot Limit",-1)),d(e("input",{type:"number",id:"spotLimit","onUpdate:modelValue":t[5]||(t[5]=s=>n.value.spot_limit=s),placeholder:"Enter Spot Limit",class:"form-control",min:"1",required:""},null,512),[[c,n.value.spot_limit,void 0,{number:!0}]])]),e("div",be,[t[23]||(t[23]=e("label",{for:"entryFees"},"Entry Fees",-1)),e("div",ze,[t[22]||(t[22]=e("span",{class:"input-prefix"},"Rs",-1)),d(e("input",{type:"number",id:"entryFees","onUpdate:modelValue":t[6]||(t[6]=s=>n.value.entry_fees=s),placeholder:"Input Entry Fees",class:"form-control",min:"0",required:""},null,512),[[c,n.value.entry_fees,void 0,{number:!0}]])])]),e("div",ge,[t[25]||(t[25]=e("label",{for:"prizeMoney"},"Prize Money",-1)),e("div",qe,[t[24]||(t[24]=e("span",{class:"input-prefix"},"Rs",-1)),d(e("input",{type:"number",id:"prizeMoney","onUpdate:modelValue":t[7]||(t[7]=s=>n.value.prize_money=s),placeholder:"Input Prize Money",class:"form-control",min:"0",required:""},null,512),[[c,n.value.prize_money,void 0,{number:!0}]])])]),e("div",Ve,[t[26]||(t[26]=e("label",{for:"quiztimer"},"Quiz Timer",-1)),d(e("input",{type:"number",id:"quizTimer","onUpdate:modelValue":t[8]||(t[8]=s=>n.value.quiz_timer=s),placeholder:"Quiz Timer in Seconds",class:"form-control",min:"0",required:""},null,512),[[c,n.value.quiz_timer,void 0,{number:!0}]]),t[27]||(t[27]=e("span",{style:{"font-size":"14px",color:"darkgrey"}},"Quiz Timer in Seconds",-1))]),t[28]||(t[28]=e("div",{class:"form-actions"},[e("button",{type:"submit",class:"btn-save"}," Proceed to Variants ")],-1))],32)):k("",!0),y.value===2?(l(),a("div",ke,[e("div",Se,[e("h3",Ce,"Quiz Variant "+u(w.value+1),1),e("div",he,[t[30]||(t[30]=e("label",{for:"entryFees"},"Entry Fees",-1)),e("div",we,[t[29]||(t[29]=e("span",{class:"input-prefix"},"Rs",-1)),d(e("input",{type:"number",id:"entryFees","onUpdate:modelValue":t[9]||(t[9]=s=>r.value.entry_fee=s),placeholder:"Input Entry Fees",class:"form-control",min:"0",required:""},null,512),[[c,r.value.entry_fee,void 0,{number:!0}]])])]),e("div",Oe,[t[32]||(t[32]=e("label",{for:"prizeMoney"},"Prize Money",-1)),e("div",Qe,[t[31]||(t[31]=e("span",{class:"input-prefix"},"Rs",-1)),d(e("input",{type:"number",id:"prizeMoney","onUpdate:modelValue":t[10]||(t[10]=s=>r.value.prize=s),placeholder:"Input Prize Money",class:"form-control",min:"0",required:""},null,512),[[c,r.value.prize,void 0,{number:!0}]])])]),e("div",Ee,[t[33]||(t[33]=e("label",{for:"spotLimit"},"Slot Limit",-1)),d(e("input",{type:"number",id:"spotLimit","onUpdate:modelValue":t[11]||(t[11]=s=>r.value.slot_limit=s),placeholder:"Enter Slot Limit",class:"form-control",min:"1",required:""},null,512),[[c,r.value.slot_limit,void 0,{number:!0}]])]),e("div",$e,[t[35]||(t[35]=e("label",{for:"status"},"Status",-1)),d(e("select",{id:"status","onUpdate:modelValue":t[12]||(t[12]=s=>r.value.status=s),class:"form-control",required:""},t[34]||(t[34]=[e("option",{value:"active"},"Active",-1),e("option",{value:"inactive"},"Inactive",-1),e("option",{value:"draft"},"Draft",-1)]),512),[[E,r.value.status]])]),e("div",Ae,[e("div",{class:"prize-distribution-header"},[t[36]||(t[36]=e("label",null,"Prize Distribution",-1)),e("button",{type:"button",onClick:F,class:"btn-add-rank"},"+ Add Rank")]),e("div",Ne,[(l(!0),a(q,null,V(r.value.prize_contents,(s,i)=>(l(),a("div",{key:i,class:"prize-rank-item"},[e("div",Ue,"Rank "+u(i),1),e("div",Te,[t[37]||(t[37]=e("span",{class:"input-prefix"},"Rs",-1)),d(e("input",{type:"number","onUpdate:modelValue":p=>r.value.prize_contents[i]=p,placeholder:"Prize amount",class:"form-control",min:"0",required:""},null,8,Je),[[c,r.value.prize_contents[i],void 0,{number:!0}]])]),e("button",{type:"button",onClick:p=>M(i),class:"btn-remove-rank",title:"Remove this rank"}," Ã— ",8,Ie)]))),128))])])]),e("div",xe,[e("button",{type:"button",onClick:P,class:"btn-cancel"}," Back to Quiz Info "),e("button",{type:"button",onClick:L,class:"btn-save"},u(C.value?"Update Variant":"Add Variant"),1),e("button",{type:"button",onClick:D,class:"btn-primary",disabled:v.value.length===0}," Proceed to Questions ",8,De)]),v.value.length>0?(l(),a("div",Pe,[e("h3",Re,"Variants Added ("+u(v.value.length)+")",1),(l(!0),a(q,null,V(v.value,(s,i)=>(l(),a("div",{key:`variant-${i}`,class:"variant-summary-item"},[e("div",Fe,u(i+1),1),e("div",Me,[e("span",Le,"Entry: Rs "+u(s.entry_fee),1),e("span",Be,"Prize: Rs "+u(s.prize),1),e("span",je,"Slots: "+u(s.slot_limit),1),e("span",{class:se(["variant-status",s.status])},u(s.status),3)]),e("div",Ye,[e("button",{onClick:p=>B(i),class:"btn-edit-variant",title:"Edit variant"}," Edit ",8,Ge),e("button",{onClick:p=>j(i),class:"btn-delete-variant",title:"Delete variant"}," Delete ",8,He)])]))),128))])):k("",!0)])):k("",!0),y.value===3?(l(),a("form",{key:2,class:"quiz-form",onSubmit:T(Y,["prevent"])},[e("div",Ke,[e("h3",We,"Question "+u(z(S)),1),e("div",Xe,[t[38]||(t[38]=e("label",{for:"question"},"Question",-1)),d(e("input",{type:"text",id:"question","onUpdate:modelValue":t[13]||(t[13]=s=>f.value.question=s),placeholder:"Enter your question",class:"form-control",required:""},null,512),[[c,f.value.question]])]),e("div",Ze,[t[39]||(t[39]=e("label",null,"Options",-1)),e("div",et,[(l(!0),a(q,null,V(f.value.options,(s,i)=>(l(),a("div",{key:`option-${i}`,class:"option-item"},[e("label",{for:`option${i+1}`},"Option "+u(i+1),9,tt),d(e("input",{id:`option${i+1}`,type:"text","onUpdate:modelValue":p=>s.option=p,placeholder:`Option ${i+1}`,class:"form-control",required:""},null,8,st),[[c,s.option]])]))),128))])]),e("div",it,[t[41]||(t[41]=e("label",{for:"correctAnswer"},"Correct Answer",-1)),d(e("select",{id:"correctAnswer","onUpdate:modelValue":t[14]||(t[14]=s=>f.value.correctAnswerId=s),class:"form-control",required:""},[t[40]||(t[40]=e("option",{value:""},"Select correct answer",-1)),(l(!0),a(q,null,V(f.value.options,(s,i)=>(l(),a("option",{key:`answer-${i}`,value:s.id,disabled:!s.option},u(s.option||`Option ${i+1}`),9,ot))),128))],512),[[E,f.value.correctAnswerId]])])]),e("div",nt,[e("button",{type:"button",onClick:R,class:"btn-cancel"}," Back to Variants "),t[42]||(t[42]=e("button",{type:"submit",class:"btn-save"}," Add Question ",-1)),e("button",{type:"button",onClick:K,class:"btn-primary",disabled:z(b).length===0||z(O).loading},u(z(O).loading?"Creating Quiz...":"Finish & Create Quiz"),9,rt)]),z(b).length>0?(l(),a("div",at,[e("h3",lt,"Questions Added ("+u(z(b).length)+")",1),(l(!0),a(q,null,V(z(b),(s,i)=>(l(),a("div",{key:`summary-${i}`,class:"question-summary-item"},[e("div",ut,u(i+1),1),e("div",dt,u(s.question),1),e("div",pt,[e("button",{onClick:p=>G(i),class:"btn-delete-question",title:"Delete question"}," Delete ",8,mt)])]))),128))])):k("",!0)],32)):k("",!0)]))}},bt=X(ct,[["__scopeId","data-v-29da4c4e"]]);export{bt as default};
