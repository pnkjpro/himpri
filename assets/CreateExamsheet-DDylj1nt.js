import{_ as K,u as W,r as y,c as a,b as e,t as u,w as A,f as d,y as Q,F as z,d as g,v as c,m as q,i as S,o as l,x as X}from"./index-lwxLPvsS.js";import{u as Z}from"./adminStore-C6vRXUJm.js";const ee={class:"quiz-form-container"},te={class:"form-title"},se={class:"form-group"},ie=["value"],oe={class:"form-group"},ne={class:"form-group"},re={class:"form-group"},ae={key:0,class:"image-preview"},le=["src"],ue={class:"form-group date-time-group"},de={class:"date-time-input"},pe={class:"date-time-input"},ce={class:"form-group"},me={class:"form-group"},ve={class:"input-with-prefix"},fe={class:"form-group"},_e={class:"input-with-prefix"},ye={key:1,class:"quiz-form"},be={class:"variant-section"},ze={class:"section-title"},ge={class:"form-group"},qe={class:"input-with-prefix"},Ve={class:"form-group"},ke={class:"input-with-prefix"},Se={class:"form-group"},Ce={class:"form-group"},he={class:"form-group"},we={class:"prize-ranks-container"},Oe={class:"rank-label"},Qe={class:"input-with-prefix"},$e=["onUpdate:modelValue"],Ee=["onClick"],Ne={class:"form-actions"},Ae=["disabled"],Ue={key:0,class:"variants-summary"},Je={class:"summary-title"},Ie={class:"variant-summary-number"},Pe={class:"variant-summary-text"},De={class:"variant-detail"},xe={class:"variant-detail"},Fe={class:"variant-detail"},Re={class:"variant-actions"},Te=["onClick"],Me=["onClick"],Le={class:"question-section"},Be={class:"section-title"},je={class:"form-group"},He={class:"form-group"},Ye={class:"options-grid"},Ge=["for"],Ke=["id","onUpdate:modelValue","placeholder"],We={class:"form-group"},Xe=["value","disabled"],Ze={class:"form-actions"},et=["disabled"],tt={key:0,class:"questions-summary"},st={class:"summary-title"},it={class:"question-summary-number"},ot={class:"question-summary-text"},nt={class:"question-actions"},rt=["onClick"],at={__name:"CreateExamsheet",setup(lt){const p=W();let V=y(1),b=y([]);const _=y(1),C=y(null),v=y([]),h=y(-1),k=y(!1),U=Z(),$={category_id:null,title:"",description:"",banner_image:null,start_time:"",end_time:"",quizContents:{},spot_limit:100,entry_fees:0,prize_money:0},E={entry_fee:0,prize:0,slot_limit:100,status:"active",prize_contents:{1:0}},O={id:1,question:"",options:[{id:1,option:""},{id:2,option:""},{id:3,option:""},{id:4,option:""}],correctAnswerId:""},n=y(JSON.parse(JSON.stringify($))),r=y(JSON.parse(JSON.stringify(E))),f=y(JSON.parse(JSON.stringify(O))),J=[{id:1,name:"Sports"},{id:2,name:"Current Affairs"},{id:3,name:"History"},{id:4,name:"Politics"}],I=i=>{const t=i.target.files[0];if(t){n.value.banner_image=t;const s=new FileReader;s.onload=o=>{C.value=o.target.result},s.readAsDataURL(t)}},P=()=>{if(new Date(n.value.end_time)<=new Date(n.value.start_time)){p.error("End time must be after start time");return}_.value=2,N()},D=()=>{if(v.value.length===0){p.error("You need to add at least one variant");return}_.value=3},x=()=>{_.value=1},F=()=>{_.value=2},N=()=>{r.value=JSON.parse(JSON.stringify(E)),k.value=!1,h.value=-1},R=()=>{const i=Object.keys(r.value.prize_contents),t=i.length>0?parseInt(i[i.length-1])+1:1;r.value.prize_contents[t]=0},T=i=>{const t={};Object.keys(r.value.prize_contents).filter(s=>s!==i).forEach(s=>{t[s]=r.value.prize_contents[s]}),r.value.prize_contents=t},M=()=>{if(r.value.entry_fee<0){p.error("Entry fee cannot be negative");return}if(r.value.prize<0){p.error("Prize amount cannot be negative");return}if(Object.values(r.value.prize_contents).reduce((t,s)=>t+s,0)>r.value.prize){p.error("Total prize distribution exceeds the total prize amount");return}k.value?v.value[h.value]=JSON.parse(JSON.stringify(r.value)):v.value.push(JSON.parse(JSON.stringify(r.value))),N(),p.success(k.value?"Variant updated successfully":"Variant added successfully")},L=i=>{r.value=JSON.parse(JSON.stringify(v.value[i])),h.value=i,k.value=!0},B=i=>{confirm("Are you sure you want to delete this variant?")&&(v.value.splice(i,1),p.success("Variant deleted successfully"))},j=()=>{if(!f.value.correctAnswerId){p.error("Please select a correct answer");return}b.value.push({...f.value,id:V.value}),V.value++,f.value=JSON.parse(JSON.stringify(O)),f.value.id=V.value,p.success("Question added successfully")},H=i=>{confirm("Are you sure you want to delete this question?")&&(b.value.splice(i,1),p.success("Question deleted successfully"))},Y=()=>{n.value=JSON.parse(JSON.stringify($)),v.value=[],b.value=[],f.value=JSON.parse(JSON.stringify(O)),_.value=1,V.value=1,C.value=null},G=async()=>{if(b.value.length===0){p.error("No questions added yet");return}const i=new FormData;i.append("category_id",n.value.category_id),i.append("title",n.value.title),i.append("description",n.value.description),i.append("start_time",n.value.start_time),i.append("end_time",n.value.end_time),i.append("spot_limit",n.value.spot_limit),i.append("entry_fees",n.value.entry_fees),i.append("prize_money",n.value.prize_money),n.value.banner_image&&i.append("banner_image",n.value.banner_image),v.value.forEach((s,o)=>{i.append(`quizVariants[${o}][entry_fee]`,s.entry_fee),i.append(`quizVariants[${o}][prize]`,s.prize),i.append(`quizVariants[${o}][slot_limit]`,s.slot_limit),i.append(`quizVariants[${o}][status]`,s.status),Object.entries(s.prize_contents).forEach(([m,w])=>{i.append(`quizVariants[${o}][prize_contents][${m}]`,w)})}),b.value.forEach((s,o)=>{i.append(`quizContents[${o}][id]`,s.id),i.append(`quizContents[${o}][question]`,s.question),s.options.forEach((m,w)=>{i.append(`quizContents[${o}][options][${w}][id]`,m.id),i.append(`quizContents[${o}][options][${w}][option]`,m.option)}),i.append(`quizContents[${o}][correctAnswerId]`,s.correctAnswerId)});const t=await U.createQuiz(i);t.success?(p.success(t.message),Y()):p.error(t.message)};return(i,t)=>(l(),a("div",ee,[e("h2",te,u(_.value===1?"Create Quiz":_.value===2?"Create Quiz Variants":"Create Quiz Questions"),1),_.value===1?(l(),a("form",{key:0,class:"quiz-form",onSubmit:A(P,["prevent"])},[e("div",se,[t[14]||(t[14]=e("label",{for:"category"},"Select Category",-1)),d(e("select",{id:"category","onUpdate:modelValue":t[0]||(t[0]=s=>n.value.category_id=s),class:"form-control",required:""},[(l(),a(z,null,g(J,s=>e("option",{key:s.id,value:s.id},u(s.name),9,ie)),64))],512),[[Q,n.value.category_id]])]),e("div",oe,[t[15]||(t[15]=e("label",{for:"title"},"Title",-1)),d(e("input",{type:"text",id:"title","onUpdate:modelValue":t[1]||(t[1]=s=>n.value.title=s),placeholder:"Enter Quiz Title",class:"form-control",required:""},null,512),[[c,n.value.title]])]),e("div",ne,[t[16]||(t[16]=e("label",{for:"description"},"Description",-1)),d(e("textarea",{id:"description","onUpdate:modelValue":t[2]||(t[2]=s=>n.value.description=s),placeholder:"Enter Quiz Description",class:"form-control",rows:"4",required:""},null,512),[[c,n.value.description]])]),e("div",re,[t[17]||(t[17]=e("label",{for:"bannerImage"},"Banner Image",-1)),e("input",{type:"file",id:"bannerImage",onChange:I,class:"form-control file-input",accept:"image/*"},null,32),C.value?(l(),a("div",ae,[e("img",{src:C.value,alt:"Banner preview"},null,8,le)])):q("",!0)]),e("div",ue,[e("div",de,[t[18]||(t[18]=e("label",{for:"startTime"},"Start Time",-1)),d(e("input",{type:"datetime-local",id:"startTime","onUpdate:modelValue":t[3]||(t[3]=s=>n.value.start_time=s),class:"form-control",required:""},null,512),[[c,n.value.start_time]])]),e("div",pe,[t[19]||(t[19]=e("label",{for:"endTime"},"End Time",-1)),d(e("input",{type:"datetime-local",id:"endTime","onUpdate:modelValue":t[4]||(t[4]=s=>n.value.end_time=s),class:"form-control",required:""},null,512),[[c,n.value.end_time]])])]),e("div",ce,[t[20]||(t[20]=e("label",{for:"spotLimit"},"Spot Limit",-1)),d(e("input",{type:"number",id:"spotLimit","onUpdate:modelValue":t[5]||(t[5]=s=>n.value.spot_limit=s),placeholder:"Enter Spot Limit",class:"form-control",min:"1",required:""},null,512),[[c,n.value.spot_limit,void 0,{number:!0}]])]),e("div",me,[t[22]||(t[22]=e("label",{for:"entryFees"},"Entry Fees",-1)),e("div",ve,[t[21]||(t[21]=e("span",{class:"input-prefix"},"Rs",-1)),d(e("input",{type:"number",id:"entryFees","onUpdate:modelValue":t[6]||(t[6]=s=>n.value.entry_fees=s),placeholder:"Input Entry Fees",class:"form-control",min:"0",required:""},null,512),[[c,n.value.entry_fees,void 0,{number:!0}]])])]),e("div",fe,[t[24]||(t[24]=e("label",{for:"prizeMoney"},"Prize Money",-1)),e("div",_e,[t[23]||(t[23]=e("span",{class:"input-prefix"},"Rs",-1)),d(e("input",{type:"number",id:"prizeMoney","onUpdate:modelValue":t[7]||(t[7]=s=>n.value.prize_money=s),placeholder:"Input Prize Money",class:"form-control",min:"0",required:""},null,512),[[c,n.value.prize_money,void 0,{number:!0}]])])]),t[25]||(t[25]=e("div",{class:"form-actions"},[e("button",{type:"submit",class:"btn-save"}," Proceed to Variants ")],-1))],32)):q("",!0),_.value===2?(l(),a("div",ye,[e("div",be,[e("h3",ze,"Quiz Variant "+u(h.value+1),1),e("div",ge,[t[27]||(t[27]=e("label",{for:"entryFees"},"Entry Fees",-1)),e("div",qe,[t[26]||(t[26]=e("span",{class:"input-prefix"},"Rs",-1)),d(e("input",{type:"number",id:"entryFees","onUpdate:modelValue":t[8]||(t[8]=s=>r.value.entry_fee=s),placeholder:"Input Entry Fees",class:"form-control",min:"0",required:""},null,512),[[c,r.value.entry_fee,void 0,{number:!0}]])])]),e("div",Ve,[t[29]||(t[29]=e("label",{for:"prizeMoney"},"Prize Money",-1)),e("div",ke,[t[28]||(t[28]=e("span",{class:"input-prefix"},"Rs",-1)),d(e("input",{type:"number",id:"prizeMoney","onUpdate:modelValue":t[9]||(t[9]=s=>r.value.prize=s),placeholder:"Input Prize Money",class:"form-control",min:"0",required:""},null,512),[[c,r.value.prize,void 0,{number:!0}]])])]),e("div",Se,[t[30]||(t[30]=e("label",{for:"spotLimit"},"Slot Limit",-1)),d(e("input",{type:"number",id:"spotLimit","onUpdate:modelValue":t[10]||(t[10]=s=>r.value.slot_limit=s),placeholder:"Enter Slot Limit",class:"form-control",min:"1",required:""},null,512),[[c,r.value.slot_limit,void 0,{number:!0}]])]),e("div",Ce,[t[32]||(t[32]=e("label",{for:"status"},"Status",-1)),d(e("select",{id:"status","onUpdate:modelValue":t[11]||(t[11]=s=>r.value.status=s),class:"form-control",required:""},t[31]||(t[31]=[e("option",{value:"active"},"Active",-1),e("option",{value:"inactive"},"Inactive",-1),e("option",{value:"draft"},"Draft",-1)]),512),[[Q,r.value.status]])]),e("div",he,[e("div",{class:"prize-distribution-header"},[t[33]||(t[33]=e("label",null,"Prize Distribution",-1)),e("button",{type:"button",onClick:R,class:"btn-add-rank"},"+ Add Rank")]),e("div",we,[(l(!0),a(z,null,g(r.value.prize_contents,(s,o)=>(l(),a("div",{key:o,class:"prize-rank-item"},[e("div",Oe,"Rank "+u(o),1),e("div",Qe,[t[34]||(t[34]=e("span",{class:"input-prefix"},"Rs",-1)),d(e("input",{type:"number","onUpdate:modelValue":m=>r.value.prize_contents[o]=m,placeholder:"Prize amount",class:"form-control",min:"0",required:""},null,8,$e),[[c,r.value.prize_contents[o],void 0,{number:!0}]])]),e("button",{type:"button",onClick:m=>T(o),class:"btn-remove-rank",title:"Remove this rank"}," Ã— ",8,Ee)]))),128))])])]),e("div",Ne,[e("button",{type:"button",onClick:x,class:"btn-cancel"}," Back to Quiz Info "),e("button",{type:"button",onClick:M,class:"btn-save"},u(k.value?"Update Variant":"Add Variant"),1),e("button",{type:"button",onClick:D,class:"btn-primary",disabled:v.value.length===0}," Proceed to Questions ",8,Ae)]),v.value.length>0?(l(),a("div",Ue,[e("h3",Je,"Variants Added ("+u(v.value.length)+")",1),(l(!0),a(z,null,g(v.value,(s,o)=>(l(),a("div",{key:`variant-${o}`,class:"variant-summary-item"},[e("div",Ie,u(o+1),1),e("div",Pe,[e("span",De,"Entry: Rs "+u(s.entry_fee),1),e("span",xe,"Prize: Rs "+u(s.prize),1),e("span",Fe,"Slots: "+u(s.slot_limit),1),e("span",{class:X(["variant-status",s.status])},u(s.status),3)]),e("div",Re,[e("button",{onClick:m=>L(o),class:"btn-edit-variant",title:"Edit variant"}," Edit ",8,Te),e("button",{onClick:m=>B(o),class:"btn-delete-variant",title:"Delete variant"}," Delete ",8,Me)])]))),128))])):q("",!0)])):q("",!0),_.value===3?(l(),a("form",{key:2,class:"quiz-form",onSubmit:A(j,["prevent"])},[e("div",Le,[e("h3",Be,"Question "+u(S(V)),1),e("div",je,[t[35]||(t[35]=e("label",{for:"question"},"Question",-1)),d(e("input",{type:"text",id:"question","onUpdate:modelValue":t[12]||(t[12]=s=>f.value.question=s),placeholder:"Enter your question",class:"form-control",required:""},null,512),[[c,f.value.question]])]),e("div",He,[t[36]||(t[36]=e("label",null,"Options",-1)),e("div",Ye,[(l(!0),a(z,null,g(f.value.options,(s,o)=>(l(),a("div",{key:`option-${o}`,class:"option-item"},[e("label",{for:`option${o+1}`},"Option "+u(o+1),9,Ge),d(e("input",{id:`option${o+1}`,type:"text","onUpdate:modelValue":m=>s.option=m,placeholder:`Option ${o+1}`,class:"form-control",required:""},null,8,Ke),[[c,s.option]])]))),128))])]),e("div",We,[t[38]||(t[38]=e("label",{for:"correctAnswer"},"Correct Answer",-1)),d(e("select",{id:"correctAnswer","onUpdate:modelValue":t[13]||(t[13]=s=>f.value.correctAnswerId=s),class:"form-control",required:""},[t[37]||(t[37]=e("option",{value:""},"Select correct answer",-1)),(l(!0),a(z,null,g(f.value.options,(s,o)=>(l(),a("option",{key:`answer-${o}`,value:s.id,disabled:!s.option},u(s.option||`Option ${o+1}`),9,Xe))),128))],512),[[Q,f.value.correctAnswerId]])])]),e("div",Ze,[e("button",{type:"button",onClick:F,class:"btn-cancel"}," Back to Variants "),t[39]||(t[39]=e("button",{type:"submit",class:"btn-save"}," Add Question ",-1)),e("button",{type:"button",onClick:G,class:"btn-primary",disabled:S(b).length===0}," Finish & Create Quiz ",8,et)]),S(b).length>0?(l(),a("div",tt,[e("h3",st,"Questions Added ("+u(S(b).length)+")",1),(l(!0),a(z,null,g(S(b),(s,o)=>(l(),a("div",{key:`summary-${o}`,class:"question-summary-item"},[e("div",it,u(o+1),1),e("div",ot,u(s.question),1),e("div",nt,[e("button",{onClick:m=>H(o),class:"btn-delete-question",title:"Delete question"}," Delete ",8,rt)])]))),128))])):q("",!0)],32)):q("",!0)]))}},pt=K(at,[["__scopeId","data-v-5f34234f"]]);export{pt as default};
